<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <script type="application/javascript">

        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        const lightModeMediaQuery = window.matchMedia('(prefers-color-scheme: light)');

        const container = document.createElement('div');
        container.style.width = '1500px';
        container.style.height = '1000px';
        container.style.margin = 'auto';
        container.style.position = 'absolute';
        container.style.top = '0';
        container.style.bottom = '0';
        container.style.left = '0';
        container.style.right = '0';
        container.style.borderRadius = '25px';
        container.style.overflow = 'hidden'; 
        container.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.5)';

        const containertext = document.createElement('div');
        containertext.style.width = '1400px';
        containertext.style.height = '850px'; 
        containertext.style.margin = 'auto';
        containertext.style.overflowY = 'auto';
        containertext.style.paddingLeft = '50px';
        containertext.style.paddingRight = '50px';
        containertext.style.position = 'relative';
        containertext.style.zIndex = '1';

        const boton = document.createElement('button');
        boton.style.width = '300px'
        boton.style.height = '80px'
        boton.style.position = 'relative'
        boton.style.left = '80px'
        boton.style.bottom = '10px'
        boton.style.borderRadius = '40px';
        boton.style.margin = '5px 5px'
        boton.style.fontSize = '30px'
        boton.style.fontFamily = 'Montserrat'
        boton.style.backgroundColor = '#78EDD5'
        boton.style.border = '1px solid #5AD7BD';
        boton.append('SEND');

        const t = document.createElement('textarea');
        t.maxLength = 140
        t.style.width = '70%'
        t.style.height = '80px'
        t.style.position = 'relative'
        t.style.left = '60px'
        t.style.top = '20px'
        t.style.borderRadius = '40px';
        t.style.fontSize = '30px'
        t.style.border = '1px solid #AFAEAE';
        t.style.resize = 'none'
        t.style.fontFamily = 'Montserrat'
        t.style.paddingLeft = '30px'
        t.style.lineHeight = '80px';

        container.appendChild(containertext);
        container.appendChild(t);
        container.appendChild(boton);
        document.body.appendChild(container);

        const getMessages = async () => {
            const response = await fetch('https://chat.tiburoncin.lat/messages');
            const messages = await response.json();
            containertext.innerHTML = ''; 
    
            for (let i = messages.length - 1; i >= 0; i--) {
                const message = messages[i];
                const h2 = document.createElement('h2');
                h2.style.borderRadius = '25px';
                h2.style.height = '75px';
                h2.style.width = '85%';
                h2.style.justifyContent = 'center';
                h2.style.paddingTop = '45px';
                h2.style.paddingLeft = '50px';
                h2.style.overflow = 'hidden';
                h2.style.whiteSpace = 'nowrap';
                h2.style.textOverflow = 'ellipsis';
                h2.style.fontFamily = 'Montserrat'
                h2.style.fontWeight = '450'
        
                if (message.username === 'DiegoDS') {
                    h2.style.border = '1px solid rgba(62, 194, 255, 0.4)';
                    h2.style.backgroundColor = 'rgba(62, 194, 255, 0.4)';
                    h2.style.marginLeft = 'auto';
                } 
                else {
                    h2.style.border = '1px solid rgba(57, 231, 89, 0.5)';
                    h2.style.backgroundColor = 'rgba(57, 231, 89, 0.5)';
                }
        
                h2.textContent = `${message.username}: ${message.message}`;
                containertext.appendChild(h2); 
            }
        
            containertext.scrollTop = containertext.scrollHeight;
        };


        getMessages();

            const postMessages = async () => {
                console.log(t.value)
                const body = {
                    username: 'DiegoDS',
                    message: t.value,
                }
                const response = await fetch('https://chat.tiburoncin.lat/messages',
                {
                    method: 'POST',
                    body: JSON.stringify(body)
                })
                t.value = ''; 
                await getMessages();
            }

        const handleKeyPress = (event) => {
            if (event.keyCode === 13 && !event.shiftKey && t.value !== '') { 
                event.preventDefault(); 
                postMessages(); 
            }
        };

        const autoRefresh = () => {
            setInterval(getMessages, 5000);
        };
        
        function applyLightModeStyles() {
            document.body.style.backgroundColor = '#fff';
            document.body.style.color = '#333';
            container.style.backgroundColor = '#FFFFFF';
            containertext.style.backgroundColor = '#E7E7E7';
        }

        function applyDarkModeStyles() {
            document.body.style.backgroundColor = '#333';
            document.body.style.color = '#fff';
            container.style.backgroundColor = '#B6B6B6';
            containertext.style.backgroundColor = '#8F9090';
        }
        
        function toggleThemeMode() {
            if (darkModeMediaQuery.matches) {
                applyDarkModeStyles();
            } else if (lightModeMediaQuery.matches) {
                applyLightModeStyles();
            } else {
                applyLightModeStyles();
            }    
        }

        // Verificar si el navegador prefiere un tema oscuro
        const prefersDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

// Verificar si el navegador prefiere un tema claro
        const prefersLightMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;

// Imprimir el resultado en la consola
        console.log('Preferencia de tema oscuro:', prefersDarkMode);
        console.log('Preferencia de tema claro:', prefersLightMode);
       
        toggleThemeMode();
        darkModeMediaQuery.addListener(toggleThemeMode);
        lightModeMediaQuery.addListener(toggleThemeMode);
        t.addEventListener('keypress', handleKeyPress);
        boton.addEventListener('click', postMessages);
        window.onload = autoRefresh;
            
        </script>
    </body>
</html>